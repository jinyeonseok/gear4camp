<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gear4camp.mapper.CartMapper">

    <!-- 장바구니 등록 -->
    <insert id="insertCart" parameterType="com.gear4camp.domain.Cart">
        INSERT INTO cart (
                           user_id
                         , product_id
                         , quantity
                         ) VALUES
                         (
                           #{userId}
                         , #{productId}
                         , #{quantity}
                         )
    </insert>

    <!-- 중복 확인 -->
    <select id="findByUserIdAndProductId" resultType="com.gear4camp.domain.Cart">
        SELECT *
          FROM cart
         WHERE user_id = #{userId}
           AND product_id = #{productId}
    </select>

    <!-- 사용자 장바구니 전체 조회 -->
    <select id="findByUserId" resultType="com.gear4camp.domain.Cart">
        SELECT *
          FROM cart
         WHERE user_id = #{userId}
         ORDER BY created_at DESC
    </select>

    <!-- 장바구니 수량 변경 -->
    <update id="updateQuantity">
        UPDATE cart
           SET quantity = #{quantity}
             , updated_at = CURRENT_TIMESTAMP
         WHERE id = #{id}
    </update>

    <!-- 장바구니 삭제 -->
    <delete id="deleteCart">
        DELETE
          FROM cart
         WHERE id = #{id}
    </delete>

    <!-- 단건 조회 -->
    <select id="findById" resultType="com.gear4camp.domain.Cart">
        SELECT *
          FROM cart
         WHERE id = #{id}
    </select>

</mapper>